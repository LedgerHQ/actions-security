name: Publish to Confluence
on: push

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20 
      
      - name: Rename all .md files
        run: find . -depth -name "*.md" -exec sh -c 'f="{}"; mv -- "$f" "$(dirname "$f")/sign_container_$(basename "$f")"' \;

      - name: Replace comments with a space
        run: find . -type f -name "*.md" -exec sed -i 's/<!--.*-->/ /g' {} +  

      - name: Publish Markdown to Confluence
        uses: markdown-confluence/publish-action@v5
        with:
          confluenceBaseUrl: https://ledgerhq.atlassian.net/
          confluenceParentId: 5036769289
          atlassianUserName: ${{ secrets.ATLASSIAN_USERNAME }}
          atlassianApiToken: ${{ secrets.ATLASSIAN_API_TOKEN }}
          folderToPublish: .
          contentRoot: actions/sign-container/
          #configFile: .markdown-confluence.json
